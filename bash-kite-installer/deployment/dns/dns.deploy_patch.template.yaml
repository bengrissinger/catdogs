spec:
  template:
    spec:
      containers:
      - name: tufindns
        image: "#TUFIN_COREDNS_IMAGE#"
        imagePullPolicy: Always
        args:
        - "-conf"
        - "/etc/coredns/Corefile"
        volumeMounts:
        - name: "config-volume-tufin"
          mountPath: "/etc/coredns"
          readOnly: true
        env:
        - name: TUFIN_GRPC_DISCOVERY_URL
          valueFrom:
            configMapKeyRef:
              name: tufindns
              key: grpc-discovery-url
        - name: TUFIN_FALLTHROUGH_DOMAINS
          valueFrom:
            configMapKeyRef:
              name: tufindns
              key: guru-url
        - name: TUFIN_FALLTHROUGH_SOURCES
          value: 127.0.0.1
        ports:
        - containerPort: #TUFIN_COREDNS_PORT#
          name: dns
          protocol: UDP
        - containerPort: 54
          name: "dns-tcp"
          protocol: TCP
        - containerPort: 9154
          name: metrics
          protocol: TCP
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            add:
            - NET_BIND_SERVICE
            drop:
            - all
          readOnlyRootFilesystem: true
        livenessProbe:
          failureThreshold: 5
          httpGet:
            path: "/health"
            port: 8091
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
      volumes:
      - name: "config-volume-tufin"
        configMap:
          name: tufindns
          items:
          - key: Corefile
            path: Corefile
